{{$partitions := .partitions }}

<html>
<head>
    {{ template "header" (print .pageHeader " - " $.subHeader) }}
</head>

<body>
{{ template "navbar" .context }}
<div class="container">
<h1 class="page-header" id="top">{{ .pageHeader }} <small>{{ .subHeader }} - {{ .totalEvents }} events / {{ .groups }} groups</small></h1>
<div class="row">
<div class="main">
<ul class="nav flex-column col-md-2">
    <h4>{{ .breakdown }}</h4>
    {{ range $heading := .headings }}
    <li class="nav-item">
        <a class="nav-link groupLink" href="#{{ $heading | toId }}">{{ $heading }}
            ({{ len (index $partitions $heading) }})</a>
    </li>
    {{ end }}
</ul>
<div class="list-group col-md-10">
    <h4>Events</h4>
    {{ range $heading := .headings }}
        <h5 id="{{ $heading | toId }}">{{ $heading }} (<a href="#top">top</a>) <a onclick="toggleAvailable()" href="#{{ $heading | toId }}" class="toggleLink">hide unavailable events</a></h5>
        {{ range $row := (index $partitions $heading) }}
        <a href="/event/{{ $row.EventId }}"
           class="list-group-item eventGroup {{ if eq $row.TotalTickets 0 }}noTickets{{end}}" style="font-size: small">
            <h5>{{ $row.Name }} <small>{{ $row.GameSystem }}</small></h5>
            <p>{{ $row.Description }}</p>
            <ul class="list-inline eventTickets">
                <li {{ if eq $row.WedTickets 0 }}class="noTickets"{{end}}><strong>Wed</strong> {{ $row.WedTickets }} tickets</li>
                <li {{ if eq $row.ThursTickets 0 }}class="noTickets"{{end}}><strong>Thurs</strong> {{ $row.ThursTickets}} tickets</li>
                <li {{ if eq $row.FriTickets 0 }}class="noTickets"{{end}}><strong>Fri</strong> {{ $row.FriTickets}} tickets</li>
                <li {{ if eq $row.SatTickets 0 }}class="noTickets"{{end}}><strong>Sat</strong> {{ $row.SatTickets}} tickets</li>
                <li {{ if eq $row.SunTickets 0 }}class="noTickets"{{end}}><strong>Sun</strong> {{ $row.SunTickets}} tickets</li>
            </ul>
        </a>
        {{ end }}
    {{ end }}
</div>
</div>
</div>
</div>

<script lang="javascript">
    function toggleAvailable() {
        if (window.eventsHidden) {
            $('a.toggleLink').text("hide unavailable events")
        } else {
            $('a.toggleLink').text("show unavailable events")
        }
        window.eventsHidden = !window.eventsHidden;
        $('a.noTickets').toggle()
    }
</script>
{{ template "scriptFooter" }}

</body>

</html>